/* =========================================
   RESET & BASE STYLES
   ========================================= */

*, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

/* =========================================
   CSS CUSTOM PROPERTIES (VARIABLES)
   ========================================= */

:root {
    /* Colors */
    --primary-color: #E0E0E0;
    --primary-rgb: 224, 224, 224;
    --author-rgb: 245, 245, 245;
    --theme-background-rgb: 16, 19, 16;
    --site-grey: 128, 128, 128;
    
    /* Typography */
    --font-family: 'IBM Plex Mono', 'Courier New', monospace;
    --font-size: clamp(1.4rem, 2.5vw, 2.5rem);
    --author-font-size: clamp(1.1rem, 2vw, 2rem);
    --letter-spacing: 0.015em;
    
    /* Effects */
    --glow-intensity: 0.5;
    --scanline-opacity: 0.2;
    --scanline-frequency: 0.6;
    
    /* Spacing */
    --quote-padding-top: clamp(0.8rem, 0.8vw + 0.5vh, 1rem);
    --quote-padding-bottom: clamp(1.7rem, 1.5vw + 1vh, 2rem);
    --main-padding-top: clamp(3rem, 2vw + 1.5vh, 4rem);
    --quote-max-height: calc(100vh - 2 * clamp(2rem, 6vw + 3vh + 1rem, 12rem) - 3rem);
    
    /* Transitions */
    --base-transition: opacity 0.3s ease, text-shadow 0.3s ease;
    
    /* Scanline SVG Effects */
    --scanline-svg: url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="var(--scanline-frequency)" numOctaves="1" stitchTiles="stitch"/><feColorMatrix type="saturate" values="0"/><feComponentTransfer><feFuncR type="linear" slope="0.3"/><feFuncG type="linear" slope="0.3"/><feFuncB type="linear" slope="0.3"/><feFuncA type="linear" slope="0.1"/></feComponentTransfer></filter><rect width="100" height="100" filter="url(%23n)" fill="black"/></svg>');
    --base-scanline-svg: var(--scanline-svg);
    --static-noise: url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><filter id="s"><feTurbulence type="fractalNoise" baseFrequency="1.2" numOctaves="0" stitchTiles="stitch"/><feColorMatrix type="saturate" values="0"/><feComponentTransfer><feFuncR type="linear" slope="0.15"/><feFuncG type="linear" slope="0.15"/><feFuncB type="linear" slope="0.15"/><feFuncA type="linear" slope="0.03"/></feComponentTransfer></filter><rect width="100" height="100" filter="url(%23s)" fill="black" opacity="0.08"/></svg>');
}

/* =========================================
   BODY & SCANLINE EFFECTS
   ========================================= */

body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9999;
    background: var(--scanline-background, transparent), var(--static-noise);
    background-repeat: repeat;
    background-size: auto, 200px 200px;
    opacity: var(--scanline-opacity);
    transform: translateZ(0);
}

body[class^="theme-"] {
    background-color: var(--theme-background, #121212);
    color: var(--primary-color);
    display: flex;
    flex-direction: column;
    font-family: var(--font-family);
    font-feature-settings: 'liga' 1, 'clig' 1, 'calt' 1;
    line-height: 1.6;
    margin: 0;
    min-height: 100vh;
    overflow-y: hidden;
    padding: clamp(2rem, 6vw + 3vh + 1rem, 12rem) clamp(1rem, 1vw + 0.5vh + 0.5rem, 2rem);
    text-rendering: optimizeLegibility;
    white-space: pre-wrap;
    overflow-wrap: break-word;
    word-wrap: break-word;
    letter-spacing: var(--letter-spacing);
    transition: background-color 0.8s cubic-bezier(0.4, 0, 0.2, 1), 
                color 0.8s cubic-bezier(0.4, 0, 0.2, 1), 
                text-shadow 0.6s ease;
    scrollbar-color: var(--primary-color) var(--theme-background);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

body[class^="theme-"] * {
    transition: color 0.6s cubic-bezier(0.4, 0, 0.2, 1), 
                background-color 0.6s cubic-bezier(0.4, 0, 0.2, 1), 
                border-color 0.6s cubic-bezier(0.4, 0, 0.2, 1), 
                text-shadow 0.5s ease, 
                box-shadow 0.5s ease;
}

body[class^="theme-"]::before {
    transition: background 0.8s cubic-bezier(0.4, 0, 0.2, 1), 
                opacity 0.6s ease;
}

/* =========================================
   THEME DEFINITIONS
   ========================================= */

.theme-ibm3279-green {
    --theme-background: #0E1210;
    --primary-color: #66FFAA;
    --author-hover-decoration: underline;
    --primary-rgb: 102, 255, 170;
    --scanline-background: repeating-linear-gradient(to bottom, rgba(255, 255, 255, 0.02) 0, rgba(0, 0, 0, 0.07) 1px, transparent 3px, transparent 6px);
}

.theme-ibm3279-bitcoin-orange {
    --theme-background: #0A0A0A;
    --primary-color: #FFAB4D;
    --author-hover-decoration: underline;
    --primary-rgb: 255, 171, 77;
    --scanline-background: repeating-linear-gradient(to bottom, rgba(255, 255, 255, 0.02) 0, rgba(0, 0, 0, 0.07) 1px, transparent 3px, transparent 6px);
}

.theme-teletype-blue-green {
    --theme-background: #111213;
    --primary-color: #B0D0B0;
    --primary-rgb: 176, 208, 176;
    --author-hover-decoration: underline;
    --scanline-frequency: 0.7;
    --scanline-background: var(--base-scanline-svg), repeating-linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 0, rgba(0, 0, 0, 0.06) 1px, transparent 2px, transparent 5px);
}

.theme-zenith-green {
    --theme-background: #101310;
    --primary-color: #A0FFA0;
    --primary-rgb: 144, 255, 144;
    --author-hover-decoration: underline;
    --scanline-frequency: 0.65;
    --scanline-background: var(--base-scanline-svg), repeating-linear-gradient(to bottom, rgba(255, 255, 255, 0.025) 0, rgba(0, 0, 0, 0.05) 1px, transparent 2px, transparent 4.5px);
}

.theme-white {
    --theme-background: #121212;
    --primary-color: #F0F0F0;
    --primary-rgb: 240, 240, 240;
    --author-hover-decoration: underline;
    --scanline-frequency: 0.6;
    --scanline-background: var(--base-scanline-svg), repeating-linear-gradient(to bottom, rgba(255, 255, 255, 0.015) 0, rgba(0, 0, 0, 0.03) 1px, transparent 2px, transparent 4px);
}

.theme-hazeltine-teal {
    --theme-background: #111314;
    --primary-color: #77DDDD;
    --primary-rgb: 136, 238, 238;
    --author-hover-decoration: underline;
    --scanline-background: repeating-linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 0, rgba(0, 0, 0, 0.06) 1px, transparent 2px, transparent 5px);
}

.theme-pet2001-green {
    --theme-background: #090909;
    --primary-color: #00FF33;
    --primary-rgb: 51, 204, 102;
    --author-hover-decoration: underline;
    --scanline-frequency: 0.6;
    --scanline-background: var(--base-scanline-svg), repeating-linear-gradient(to bottom, rgba(255, 255, 255, 0.025) 0, rgba(0, 0, 0, 0.05) 1px, transparent 2px, transparent 4.5px);
}

.theme-vt100-amber {
    --theme-background: #0A0800;
    --primary-color: #FFBF00;
    --primary-rgb: 255, 191, 0;
    --author-hover-decoration: underline;
    --scanline-frequency: 0.55;
    --scanline-background: var(--base-scanline-svg), repeating-linear-gradient(to bottom, rgba(255, 255, 255, 0.02) 0, rgba(0, 0, 0, 0.04) 1px, transparent 2px, transparent 5px);
}

.theme-apple2-green {
    --theme-background: #000000;
    --primary-color: #00FF41;
    --primary-rgb: 0, 255, 65;
    --author-hover-decoration: underline;
    --scanline-frequency: 0.65;
    --scanline-background: var(--base-scanline-svg), repeating-linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 0, rgba(0, 0, 0, 0.06) 1px, transparent 2px, transparent 4px);
}

/* =========================================
   HEADER
   ========================================= */

#header {
    position: fixed;
    top: 0;
    right: 0;
    display: flex;
    flex-direction: row;
    align-items: center;
    padding: 0.75rem clamp(0.5rem, 2vw, 0.75rem);
    z-index: 10000;
    min-height: 2rem;
    transition: opacity 0.3s ease;
    gap: 0.05rem;
    contain: layout style paint;
}

#header a {
    display: block;
    margin-bottom: 0;
}

.header-icon {
    color: rgba(var(--primary-rgb), 0.7);
    text-decoration: none;
    font-size: clamp(0.75rem, 0.8vw + 0.4vh, 0.875rem);
    transition: color 0.3s ease, text-shadow 0.3s ease, transform 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem;
    min-width: 44px;
    min-height: 44px;
    border-radius: 4px;
    contain: layout style paint;
}

.header-icon:hover,
.header-icon:focus {
    color: rgba(var(--primary-rgb), 1);
    text-shadow: 0 0 4px rgba(var(--primary-rgb), 0.7);
}

/* =========================================
   MAIN CONTENT AREA
   ========================================= */

main {
    padding-top: var(--main-padding-top);
    padding-left: clamp(0.5rem, 1vw, 1rem);
    padding-right: clamp(0.5rem, 1vw, 1rem);
    max-width: 100%;
    overflow-x: hidden;
}

/* =========================================
   QUOTE CONTAINER
   ========================================= */

#quote-container {
    color: rgba(var(--primary-rgb), 0.9);
    margin: 0 0 0 15px;
    min-height: 6em;
    font-size: var(--font-size);
    font-weight: 500;
    padding: var(--quote-padding-top) 0.25rem var(--quote-padding-bottom) 1rem;
    max-height: var(--quote-max-height);
    overflow-y: auto;
    text-align: left;
    width: 100%;
    transition: var(--base-transition), 
                opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1), 
                transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    line-height: 1.6;
    text-shadow: 0 0 4px rgba(var(--primary-rgb), calc(var(--glow-intensity) * 0.7));
    contain: layout style paint;
    transform: translateZ(0);
    will-change: contents, transform, opacity;
    backface-visibility: hidden;
    scroll-behavior: smooth;
    scrollbar-width: thin;
    scrollbar-color: rgba(var(--primary-rgb), 0.3) rgba(var(--primary-rgb), 0.1);
    text-rendering: geometricPrecision;
    font-variant-ligatures: none;
    letter-spacing: 0.02em;
    border-left: 3px solid var(--primary-color);
}

/* Custom Scrollbar Styling */
#quote-container::-webkit-scrollbar {
    width: 8px;
}

#quote-container::-webkit-scrollbar-track {
    background: rgba(var(--primary-rgb), 0.1);
    border-radius: 4px;
}

#quote-container::-webkit-scrollbar-thumb {
    background: rgba(var(--primary-rgb), 0.3);
    border-radius: 4px;
    transition: background 0.3s ease;
}

#quote-container::-webkit-scrollbar-thumb:hover {
    background: rgba(var(--primary-rgb), 0.5);
}

/* Theme-Specific Quote Container Glows */
.theme-ibm3279-green #quote-container {
    text-shadow: 0 0 5px rgba(0, 255, 0, 0.3);
}

.theme-teletype-blue-green #quote-container {
    text-shadow: 0 0 4px rgba(0, 255, 255, 0.25);
}

.theme-pet2001-green #quote-container {
    text-shadow: 0 0 6px rgba(50, 255, 50, 0.4);
}

.theme-ibm3279-bitcoin-orange #quote-container {
    text-shadow: 0 0 5px rgba(255, 165, 0, 0.35);
}

.theme-hazeltine-teal #quote-container {
    text-shadow: 0 0 4px rgba(0, 255, 200, 0.3);
}

.theme-zenith-green #quote-container {
    text-shadow: 0 0 5px rgba(0, 255, 100, 0.32);
}

.theme-white #quote-container {
    text-shadow: 0 0 3px rgba(255, 255, 240, 0.2);
}

.theme-vt100-amber #quote-container {
    text-shadow: 0 0 5px rgba(255, 191, 0, 0.4);
}

.theme-apple2-green #quote-container {
    text-shadow: 0 0 6px rgba(0, 255, 65, 0.35);
}

/* =========================================
   AUTHOR
   ========================================= */

.author {
    display: block;
    color: rgba(var(--primary-rgb), 0.9);
    font-weight: 400;
    margin-top: clamp(1rem, 1.2vw + 0.8vh, 2rem);
    font-size: var(--author-font-size);
    text-align: left;
    transition: var(--base-transition);
    line-height: 1.6;
    letter-spacing: 0.01em;
    font-style: italic;
    contain: layout style paint;
    transform: translateZ(0);
}

.author a {
    text-decoration: none;
    color: rgba(var(--primary-rgb), 0.9);
    transition: var(--base-transition);
}

.author a:hover,
.author a:focus {
    text-decoration: var(--author-hover-decoration, none);
}

/* =========================================
   ERROR MESSAGE
   ========================================= */

#error-message {
    display: block;
    margin-top: clamp(0.8rem, 1vw + 0.5vh, 1.2rem);
    padding: clamp(0.4rem, 0.5vw + 0.3vh, 0.6rem);
    color: var(--theme-background);
    background: rgba(var(--primary-rgb), 0.8);
    border: 1px solid var(--primary-color);
    font-weight: bold;
    box-shadow: 0 0 10px rgba(var(--primary-rgb), 0.3);
    font-family: var(--font-family);
    opacity: 0;
    transition: var(--base-transition);
}

#error-message.error-active {
    opacity: 1;
}

/* =========================================
   KEY COMMANDS (FOOTER SHORTCUTS)
   ========================================= */

#key-commands {
    color: rgba(var(--site-grey), 0.65);
    font-family: var(--font-family);
    font-size: clamp(0.55rem, 0.8vw + 0.4vh, 0.675rem);
    letter-spacing: var(--letter-spacing);
    line-height: 1.6;
    padding: 0.025rem 1rem;
    white-space: nowrap;
    font-weight: 400;
    text-align: center;
    transition: opacity 0.3s ease, transform 0.3s ease;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: clamp(0.5rem, 1vw, 1rem);
}

#key-commands span {
    display: inline-flex;
    align-items: center;
    margin: 0.1rem;
}

#key-commands .key {
    font-weight: 600;
    margin-right: 0.025rem;
    color: rgba(var(--primary-rgb), 0.5);
    text-shadow: 0 0 4px rgba(var(--primary-rgb), calc(var(--glow-intensity) * 0.7));
}

/* =========================================
   FOOTER
   ========================================= */

#footer {
    position: fixed;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    font-family: var(--font-family);
    z-index: 9997;
    contain: layout style paint;
}

.footer-subtext {
    font-size: clamp(0.5rem, 0.7vw + 0.35vh, 0.5rem);
    letter-spacing: var(--letter-spacing);
    line-height: 1.6;
    padding: 0.025rem 0.8rem 0.55rem 0.8rem;
    text-align: center;
    text-transform: uppercase;
    transition: opacity 0.3s ease;
    opacity: 0.8;
    max-width: 90vw;
    color: rgba(var(--site-grey), 0.65);
}

#footer a {
    color: rgba(var(--site-grey), 0.65);
    text-decoration: none;
    font-family: var(--font-family);
    transition: color 0.2s ease, text-decoration 0.2s ease;
}

#footer a:hover {
    color: rgba(var(--primary-rgb), 0.65);
    text-decoration: underline;
    text-shadow: 0 0 1px rgba(var(--primary-rgb), 0.3), 
                 0 0 2px rgba(var(--primary-rgb), 0.15);
}

/* =========================================
   TEXT SELECTION & HIGHLIGHTING
   ========================================= */

::selection {
    background: var(--primary-color);
    box-shadow: 0 0 3px rgba(var(--primary-rgb), 0.5), 
                0 0 6px rgba(var(--primary-rgb), 0.25), 
                0 0 12px rgba(var(--primary-rgb), 0.15);
    color: var(--theme-background);
}

.text-selected {
    background-color: var(--primary-color);
    color: var(--theme-background);
    text-shadow: none !important;
    will-change: contents;
    transform: translateZ(0);
    backface-visibility: hidden;
}

.text-selected a {
    color: var(--theme-background) !important;
    text-shadow: none !important;
}

/* =========================================
   TYPING CURSOR ANIMATION
   ========================================= */

.typing-cursor {
    animation: cursor-glow 1s ease-in-out infinite alternate;
}

@keyframes cursor-glow {
    from {
        text-shadow: inherit;
    }
    to {
        text-shadow: inherit, 0 0 10px currentColor;
    }
}

/* =========================================
   BOOKMARK COUNTER
   ========================================= */

.bookmark-counter {
    position: fixed;
    top: clamp(0.5rem, 1.5vw, 0.65rem);
    left: clamp(0.5rem, 1.5vw, 0.65rem);
    background: transparent;
    border: none;
    font-family: var(--font-family);
    font-size: clamp(0.55rem, 0.7vw + 0.25vh, 0.65rem);
    font-weight: 400;
    color: rgba(var(--primary-rgb), 0.4);
    z-index: 10000;
    transition: opacity 0.3s ease;
    pointer-events: none;
    contain: layout style paint;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 0.15rem;
}

.bookmark-counter .count::before {
    content: '[';
    margin-right: 0.1rem;
    opacity: 0.6;
}

.bookmark-counter .count::after {
    content: ']';
    margin-left: 0.1rem;
    opacity: 0.6;
}

.bookmark-counter .heart::before {
    content: '[';
    margin-right: 0.1rem;
    opacity: 0.6;
}

.bookmark-counter .heart::after {
    content: ']';
    margin-left: 0.1rem;
    opacity: 0.6;
}

.bookmark-counter.hidden {
    opacity: 0;
}

/* =========================================
   QUOTE TRANSITION ANIMATIONS
   ========================================= */

.quote-transition-out {
    opacity: 0;
    transform: translateZ(0) translateY(-20px) scale(0.98);
}

.quote-transition-in {
    opacity: 1;
    transform: translateZ(0) translateY(0) scale(1);
}

/* =========================================
   BITCOIN ICON (SVG)
   ========================================= */

.outer-circle {
    fill: #1a1a1a !important;
}

.bitcoin-b {
    fill: var(--primary-color) !important;
    filter: drop-shadow(0 0 4px rgba(var(--primary-rgb), calc(var(--glow-intensity) * 0.7))) !important;
    -webkit-filter: drop-shadow(0 0 4px rgba(var(--primary-rgb), calc(var(--glow-intensity) * 0.7))) !important;
}

/* Theme-Specific Bitcoin Icon Colors */
.theme-ibm3279-green .bitcoin-b {
    fill: #66FFAA !important;
    filter: drop-shadow(0 0 4px rgba(102, 255, 170, 0.35)) !important;
    -webkit-filter: drop-shadow(0 0 4px rgba(102, 255, 170, 0.35)) !important;
}

.theme-teletype-blue-green .bitcoin-b {
    fill: #B0D0B0 !important;
    filter: drop-shadow(0 0 4px rgba(176, 208, 176, calc(var(--glow-intensity) * 0.7))) !important;
    -webkit-filter: drop-shadow(0 0 4px rgba(176, 208, 176, calc(var(--glow-intensity) * 0.7))) !important;
}

.theme-pet2001-green .bitcoin-b {
    fill: #00FF33 !important;
    filter: drop-shadow(0 0 4px rgba(51, 204, 102, calc(var(--glow-intensity) * 0.7))) !important;
    -webkit-filter: drop-shadow(0 0 4px rgba(51, 204, 102, calc(var(--glow-intensity) * 0.7))) !important;
}

.theme-ibm3279-bitcoin-orange .bitcoin-b {
    fill: #FFAB4D !important;
    filter: drop-shadow(0 0 4px rgba(255, 171, 77, calc(var(--glow-intensity) * 0.7))) !important;
    -webkit-filter: drop-shadow(0 0 4px rgba(255, 171, 77, calc(var(--glow-intensity) * 0.7))) !important;
}

.theme-hazeltine-teal .bitcoin-b {
    fill: #77DDDD !important;
    filter: drop-shadow(0 0 4px rgba(136, 238, 238, calc(var(--glow-intensity) * 0.7))) !important;
    -webkit-filter: drop-shadow(0 0 4px rgba(136, 238, 238, calc(var(--glow-intensity) * 0.7))) !important;
}

.theme-zenith-green .bitcoin-b {
    fill: #A0FFA0 !important;
    filter: drop-shadow(0 0 4px rgba(144, 255, 144, calc(var(--glow-intensity) * 0.7))) !important;
    -webkit-filter: drop-shadow(0 0 4px rgba(144, 255, 144, calc(var(--glow-intensity) * 0.7))) !important;
}

.theme-white .bitcoin-b {
    fill: #F0F0F0 !important;
    filter: drop-shadow(0 0 4px rgba(240, 240, 240, calc(var(--glow-intensity) * 0.7))) !important;
    -webkit-filter: drop-shadow(0 0 4px rgba(240, 240, 240, calc(var(--glow-intensity) * 0.7))) !important;
}

.theme-vt100-amber .bitcoin-b {
    fill: #FFBF00 !important;
    filter: drop-shadow(0 0 4px rgba(255, 191, 0, calc(var(--glow-intensity) * 0.7))) !important;
    -webkit-filter: drop-shadow(0 0 4px rgba(255, 191, 0, calc(var(--glow-intensity) * 0.7))) !important;
}

.theme-apple2-green .bitcoin-b {
    fill: #00FF41 !important;
    filter: drop-shadow(0 0 4px rgba(0, 255, 65, calc(var(--glow-intensity) * 0.7))) !important;
    -webkit-filter: drop-shadow(0 0 4px rgba(0, 255, 65, calc(var(--glow-intensity) * 0.7))) !important;
}

/* =========================================
   MOBILE RESPONSIVE STYLES
   ========================================= */

@media (max-width: 768px) {
    main {
        padding-top: clamp(2rem, 4vw + 2vh, 3rem);
        padding-left: 0.75rem;
        padding-right: 0.75rem;
    }
    
    #header {
        padding: 0.5rem;
        gap: 0.05rem;
    }
    
    .header-icon {
        min-width: 40px;
        min-height: 40px;
        padding: 0.4rem;
        font-size: 0.8rem;
    }
    
    #key-commands {
        font-size: clamp(0.5rem, 0.7vw + 0.3vh, 0.6rem);
        padding: 0.025rem 0.5rem;
        gap: 0.3rem;
    }
    
    #quote-container {
        font-size: clamp(1.2rem, 2vw, 2rem);
        padding: var(--quote-padding-top) 0.25rem var(--quote-padding-bottom) 0.25rem;
        margin: 0;
        text-align: left;
    }
    
    .author {
        font-size: clamp(1rem, 1.8vw, 1.8rem);
        margin-top: clamp(0.8rem, 1vw + 0.6vh, 1.5rem);
    }
    
    #footer {
        display: none;
    }
}
